<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Formulario Especificaciones</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Test Formulario de Especificaciones</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Simulación de Especificaciones</h2>
            
            <div id="especificaciones-container" class="space-y-4">
                <!-- Los campos se generarán dinámicamente aquí -->
            </div>
            
            <div id="no-especificaciones" class="hidden text-gray-500 text-center py-8">
                No hay especificaciones para esta categoría
            </div>
        </div>
        
        <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Datos del Formulario</h2>
            <pre id="form-data" class="bg-gray-100 p-4 rounded text-sm overflow-auto"></pre>
        </div>
    </div>

    <script>
        // Simular datos de especificaciones de categoría (como vendrían de la base de datos)
        const especificacionesCategoria = [
            {
                nombre_campo: 'pantalla',
                etiqueta: 'Tamaño de Pantalla',
                tipo_campo: 'texto',
                unidad: 'pulgadas',
                requerido: true,
                orden: 1
            },
            {
                nombre_campo: 'resolucion',
                etiqueta: 'Resolución',
                tipo_campo: 'texto',
                requerido: true,
                orden: 2
            },
            {
                nombre_campo: 'ram',
                etiqueta: 'Memoria RAM',
                tipo_campo: 'select',
                opciones: '2,3,4,6,8,12,16',
                unidad: 'GB',
                requerido: true,
                orden: 3
            },
            {
                nombre_campo: 'almacenamiento',
                etiqueta: 'Almacenamiento',
                tipo_campo: 'select',
                opciones: '32,64,128,256,512',
                unidad: 'GB',
                requerido: true,
                orden: 4
            },
            {
                nombre_campo: 'procesador',
                etiqueta: 'Procesador',
                tipo_campo: 'texto',
                requerido: true,
                orden: 5
            },
            {
                nombre_campo: 'bateria',
                etiqueta: 'Capacidad de Batería',
                tipo_campo: 'numero',
                unidad: 'mAh',
                requerido: true,
                orden: 6
            },
            {
                nombre_campo: 'camara_principal',
                etiqueta: 'Cámara Principal',
                tipo_campo: 'texto',
                requerido: true,
                orden: 7
            },
            {
                nombre_campo: 'sistema_operativo',
                etiqueta: 'Sistema Operativo',
                tipo_campo: 'select',
                opciones: 'Android,iOS,Windows,macOS,Linux',
                requerido: true,
                orden: 8
            },
            {
                nombre_campo: 'carga_rapida',
                etiqueta: 'Carga Rápida',
                tipo_campo: 'checkbox',
                requerido: false,
                orden: 9
            },
            {
                nombre_campo: 'resistente_agua',
                etiqueta: 'Resistente al Agua',
                tipo_campo: 'checkbox',
                requerido: false,
                orden: 10
            }
        ];

        // Valores de especificaciones (simular valores existentes)
        const valoresEspecificaciones = {};

        // Función para crear un campo de especificación
        function crearCampoEspecificacion(espec, index) {
            const valorActual = valoresEspecificaciones[espec.nombre_campo] || '';
            const requerido = espec.requerido ? '<span class="text-red-500">*</span>' : '';
            const unidad = espec.unidad ? ` (${espec.unidad})` : '';
            
            // Debug: mostrar qué tipo de campo se está procesando
            console.log(`Creando campo: ${espec.nombre_campo}, Tipo: ${espec.tipo_campo}, Etiqueta: ${espec.etiqueta}`);
            
            let campo = '';
            
            switch (espec.tipo_campo) {
                case 'text':
                case 'texto':
                    campo = `
                        <input type="text" 
                               name="especificaciones[${espec.nombre_campo}]" 
                               id="espec_${espec.nombre_campo}"
                               value="${valorActual}"
                               class="block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                               placeholder="Ingresa ${espec.etiqueta.toLowerCase()}"
                               ${espec.requerido ? 'required' : ''}>
                    `;
                    break;
                    
                case 'number':
                case 'numero':
                    campo = `
                        <input type="number" 
                               name="especificaciones[${espec.nombre_campo}]" 
                               id="espec_${espec.nombre_campo}"
                               value="${valorActual}"
                               class="block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                               placeholder="0"
                               ${espec.requerido ? 'required' : ''}>
                    `;
                    break;
                    
                case 'select':
                    // Para campos select, necesitamos obtener las opciones de la base de datos
                    // o usar opciones predefinidas si están disponibles
                    let opciones = [];
                    
                    // Si hay opciones_array definidas, usarlas
                    if (espec.opciones_array && Array.isArray(espec.opciones_array)) {
                        opciones = espec.opciones_array;
                    } else if (espec.opciones && typeof espec.opciones === 'string') {
                        // Si hay opciones como string, convertirlas a array
                        opciones = espec.opciones.split(',').map(op => op.trim());
                    } else if (espec.opciones && Array.isArray(espec.opciones)) {
                        // Si ya es un array
                        opciones = espec.opciones;
                    } else {
                        // Opciones por defecto para campos comunes
                        switch (espec.nombre_campo) {
                            case 'ram':
                                opciones = ['2GB', '4GB', '8GB', '16GB', '32GB', '64GB'];
                                break;
                            case 'almacenamiento':
                                opciones = ['32GB', '64GB', '128GB', '256GB', '512GB', '1TB', '2TB'];
                                break;
                            case 'pantalla':
                                opciones = ['5.5"', '6.1"', '6.7"', '7"', '10.1"', '11"', '13"', '15.6"', '17"'];
                                break;
                            case 'resolucion':
                                opciones = ['HD (1280x720)', 'Full HD (1920x1080)', '2K (2560x1440)', '4K (3840x2160)', 'Retina'];
                                break;
                            case 'procesador':
                                opciones = ['Intel Core i3', 'Intel Core i5', 'Intel Core i7', 'Intel Core i9', 'AMD Ryzen 3', 'AMD Ryzen 5', 'AMD Ryzen 7', 'AMD Ryzen 9', 'Apple M1', 'Apple M2', 'Apple M3'];
                                break;
                            case 'sistema_operativo':
                                opciones = ['Android', 'iOS', 'Windows', 'macOS', 'Linux'];
                                break;
                            default:
                                opciones = ['Opción 1', 'Opción 2', 'Opción 3'];
                        }
                    }
                    
                    let opcionesHtml = '<option value="">Selecciona una opción</option>';
                    opciones.forEach(opcion => {
                        const selected = valorActual === opcion ? 'selected' : '';
                        opcionesHtml += `<option value="${opcion}" ${selected}>${opcion}</option>`;
                    });
                    
                    campo = `
                        <select name="especificaciones[${espec.nombre_campo}]" 
                                id="espec_${espec.nombre_campo}"
                                class="block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                                ${espec.requerido ? 'required' : ''}>
                            ${opcionesHtml}
                        </select>
                    `;
                    break;
                    
                case 'textarea':
                    campo = `
                        <textarea name="especificaciones[${espec.nombre_campo}]" 
                                  id="espec_${espec.nombre_campo}"
                                  rows="3"
                                  class="block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                                  placeholder="Describe ${espec.etiqueta.toLowerCase()}"
                                  ${espec.requerido ? 'required' : ''}>${valorActual}</textarea>
                    `;
                    break;
                    
                case 'checkbox':
                    const checked = valorActual === '1' || valorActual === true ? 'checked' : '';
                    campo = `
                        <div class="flex items-center">
                            <input type="checkbox" 
                                   name="especificaciones[${espec.nombre_campo}]" 
                                   id="espec_${espec.nombre_campo}"
                                   value="1"
                                   ${checked}
                                   class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="espec_${espec.nombre_campo}" class="ml-2 block text-sm text-gray-700">
                                ${espec.etiqueta}
                            </label>
                        </div>
                    `;
                    break;
                    
                case 'radio':
                    const opcionesRadio = espec.opciones_array || [];
                    let radioHtml = '';
                    opcionesRadio.forEach((opcion, radioIndex) => {
                        const checked = valorActual === opcion ? 'checked' : '';
                        radioHtml += `
                            <div class="flex items-center">
                                <input type="radio" 
                                       name="especificaciones[${espec.nombre_campo}]" 
                                       id="espec_${espec.nombre_campo}_${radioIndex}"
                                       value="${opcion}"
                                       ${checked}
                                       class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"
                                       ${espec.requerido ? 'required' : ''}>
                                <label for="espec_${espec.nombre_campo}_${radioIndex}" class="ml-2 block text-sm text-gray-700">
                                    ${opcion}
                                </label>
                            </div>
                        `;
                    });
                    
                    campo = `
                        <div class="space-y-2">
                            ${radioHtml}
                        </div>
                    `;
                    break;
                    
                default:
                    // Campo por defecto si el tipo no es reconocido
                    console.warn(`Tipo de campo no reconocido: ${espec.tipo_campo} para ${espec.nombre_campo}`);
                    campo = `
                        <input type="text" 
                               name="especificaciones[${espec.nombre_campo}]" 
                               id="espec_${espec.nombre_campo}"
                               value="${valorActual}"
                               class="block w-full px-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                               placeholder="Ingresa ${espec.etiqueta.toLowerCase()}"
                               ${espec.requerido ? 'required' : ''}>
                    `;
                    break;
            }
            
            return `
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <div class="mb-2">
                        <label class="block text-sm font-medium text-gray-700">
                            ${espec.etiqueta}${unidad} ${requerido}
                        </label>
                    </div>
                    ${campo}
                </div>
            `;
        }

        // Función para renderizar especificaciones
        function renderizarEspecificaciones(especificaciones) {
            const container = document.getElementById('especificaciones-container');
            const noEspecificaciones = document.getElementById('no-especificaciones');
            
            if (!especificaciones || especificaciones.length === 0) {
                container.innerHTML = '';
                noEspecificaciones.classList.remove('hidden');
                return;
            }
            
            noEspecificaciones.classList.add('hidden');
            
            let html = '';
            especificaciones.forEach((espec, index) => {
                html += crearCampoEspecificacion(espec, index);
            });
            
            container.innerHTML = html;
            
            // Agregar event listeners
            agregarEventListenersEspecificaciones();
        }

        // Función para agregar event listeners
        function agregarEventListenersEspecificaciones() {
            especificacionesCategoria.forEach(espec => {
                const campo = document.getElementById(`espec_${espec.nombre_campo}`);
                if (campo) {
                    campo.addEventListener('change', function() {
                        guardarValorEspecificacion(espec.nombre_campo, this.value);
                        actualizarFormData();
                    });
                    
                    if (espec.tipo_campo === 'checkbox') {
                        campo.addEventListener('change', function() {
                            guardarValorEspecificacion(espec.nombre_campo, this.checked ? '1' : '0');
                            actualizarFormData();
                        });
                    }
                }
            });
        }

        // Función para guardar valor de especificación
        function guardarValorEspecificacion(nombreCampo, valor) {
            valoresEspecificaciones[nombreCampo] = valor;
        }

        // Función para actualizar la visualización de datos del formulario
        function actualizarFormData() {
            const formDataElement = document.getElementById('form-data');
            formDataElement.textContent = JSON.stringify(valoresEspecificaciones, null, 2);
        }

        // Inicializar el formulario
        document.addEventListener('DOMContentLoaded', function() {
            renderizarEspecificaciones(especificacionesCategoria);
            actualizarFormData();
        });
    </script>
</body>
</html>
